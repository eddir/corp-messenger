openapi: 3.0.0
info:
  title: Corp Messenger API
  version: 1.0.0
  description: Retrieve and send messages
servers:
  - url: "http://messenger.rostkov.me/api"
    description: Продуктовый сервер
paths:
  /auth/register:
    post:
      requestBody:
        description: Данные для регистрации нового пользователя
        content:
          application/json:
            schema:
              type: object
              required:
                - login
                - password
                - first_name
                - middle_name
                - last_name
              properties:
                login:
                  type: string
                  description: Имя пользователя
                password:
                  type: string
                  description: Пароль
                first_name:
                  type: string
                  description: Имя
                middle_name:
                  type: string
                  description: Отчество
                last_name:
                  type: string
                  description: Фамилия
        required: true
      responses:
        "201":
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/User"
          description: Пользователь успешно зарегистрирован
        "400":
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
          description: Некорректные данные
        "409":
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
          description: Пользователь с таким username уже существует
      operationId: registerUser
      tags:
        - auth
      summary: Регистрация нового пользователя
      description: Регистрация нового пользователя в системе
  /auth/login:
    post:
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UserCredentials"
        required: true
      responses:
        "200":
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Tokens"
          description: Авторизация прошла успешно
        "401":
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
          description: Неверный логин или пароль
      operationId: loginUser
      tags:
        - auth
      summary: Авторизация
      description: Авторизация пользователя в системе и получение токена
  /auth/renew:
    post:
      parameters:
        - name: refreshToken
          description: Токен обновления
          schema:
            type: string
          in: query
          required: true
      responses:
        "200":
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Tokens"
          description: Токен обновлен
        "401":
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
          description: Неверный токен обновления
      operationId: renewToken
      tags:
        - auth
      summary: Обновление токена
      description: Обновление токена доступа
  /chats:
    get:
      responses:
        "200":
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Chats"
          description: Список чатов
        "401":
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
          description: Неверный токен доступа
      operationId: getChats
      tags:
        - chats
      summary: Получение списка чатов
      description: Получение списка чатов пользователя
    post:
      requestBody:
        description: Данные для создания нового чата
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Chat"
        required: true
      responses:
        "201":
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Chat"
          description: Чат успешно создан
        "400":
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
          description: Некорректные данные
        "401":
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
          description: Неверный токен доступа
      operationId: createChat
      tags:
        - chats
      summary: Создание нового чата
      description: Создание нового чата
  "/chat/{chatId}":
    get:
      parameters:
        - name: chatId
          description: Идентификатор чата
          schema:
            type: integer
          in: path
          required: true
      responses:
        "200":
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ChatInstance"
          description: Информация о чате
        "401":
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
          description: Неверный токен доступа
        "404":
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
          description: Чат не найден
      operationId: getChat
      tags:
        - chats
      summary: Получение информации о чате
      description: Получение информации о чате
    post:
      requestBody:
        description: Данные для обновления информации о чате
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ChatInstance"
        required: true
      parameters:
        - name: chatId
          description: Идентификатор чата
          schema:
            type: integer
          in: path
          required: true
      responses:
        "200":
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Chat"
          description: Информация о чате успешно обновлена
        "400":
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
          description: Некорректные данные
        "401":
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
          description: Неверный токен доступа
        "404":
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
          description: Чат не найден
      operationId: updateChat
      tags:
        - chats
      summary: Обновление информации о чате
      description: Обновление информации о чате
    delete:
      parameters:
        - name: chatId
          description: Идентификатор чата
          schema:
            type: integer
          in: path
          required: true
      responses:
        "200":
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Chat"
          description: Чат успешно удален
        "401":
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
          description: Неверный токен доступа
        "404":
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
          description: Чат не найден
      operationId: deleteChat
      tags:
        - chats
      summary: Удаление чата
      description: Удаление чата
  "/chat/{chatId}/leave":
    post:
      parameters:
      - name: chatId
        description: Идентификатор чата
        schema:
          type: integer
        in: path
        required: true
      responses:
        "200":
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Chat"
          description: Пользователь успешно покинул чат
        "401":
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
          description: Неверный токен доступа
        "404":
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
          description: Чат не найден
      operationId: leaveChat
      tags:
        - chats
      summary: Покинуть чат
      description: Покинуть чат
  "/chat/{chatId}/invite":
    post:
      parameters:
      - name: chatId
        description: Идентификатор чата
        schema:
          type: integer
        in: path
        required: true
      requestBody:
        description: Данные о пользователе, которого нужно пригласить в чат
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/User"
        required: true
      responses:
        "200":
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Chat"
          description: Пользователь успешно приглашен в чат
        "400":
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
          description: Некорректные данные
        "401":
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
          description: Неверный токен доступа
        "404":
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
          description: Чат не найден
      operationId: inviteUser
      tags:
        - chats
      summary: Приглашение пользователя в чат
      description: Приглашение пользователя в чат
  "/chat/{chatId}/kick":
    post:
      parameters:
      - name: chatId
        description: Идентификатор чата
        schema:
          type: integer
        in: path
        required: true
      requestBody:
        description: Данные о пользователе, которого нужно исключить из чата
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/User"
        required: true
      responses:
        "200":
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Chat"
          description: Пользователь успешно исключен из чата
        "400":
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
          description: Некорректные данные
        "401":
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
          description: Неверный токен доступа
        "404":
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
          description: Чат не найден
      operationId: kickUser
      tags:
        - chats
      summary: Исключение пользователя из чата
      description: Исключение пользователя из чата

  "/chat/{chatId}/pin":
    post:
      requestBody:
        description: Данные для закрепления сообщения в чате
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Chat"
        required: true
      parameters:
        - name: chatId
          description: Идентификатор чата
          schema:
            type: integer
          in: path
          required: true
      responses:
        "200":
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Chat"
          description: Сообщение успешно закреплено
        "400":
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
          description: Некорректные данные
        "401":
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
          description: Неверный токен доступа
        "404":
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
          description: Чат не найден
      operationId: pinChatMessage
      tags:
        - chats
      summary: Закрепление сообщения в чате
      description: Закрепление сообщения в чате
    delete:
      parameters:
        - name: chatId
          description: Идентификатор чата
          schema:
            type: integer
          in: path
          required: true
      responses:
        "200":
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Chat"
          description: Сообщение успешно откреплено
        "401":
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
          description: Неверный токен доступа
        "404":
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
          description: Чат не найден
      operationId: unpinChatMessage
      tags:
        - chats
      summary: Открепление сообщения в чате
      description: Открепление сообщения в чат
  "/chat/{chatId}/messages":
    get:
      parameters:
        - name: chatId
          description: Идентификатор чата
          schema:
            type: integer
          in: path
          required: true
        - name: count
          description: Количество сообщений, которое необходимо получить
          schema:
            type: integer
          in: query
          required: false
        - name: startMessageId
          description: Идентификатор сообщения, с которого необходимо начать получение
          schema:
            type: integer
          in: query
          required: false
        - name: offset
          description: Смещение относительно startMessageId
          schema:
            type: integer
          in: query
          required: false
      responses:
        "200":
          description: Список сообщений чата
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Messages"
        "401":
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
          description: Неверный токен доступа
        "404":
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
          description: Чат не найден
      operationId: getChatMessages
      tags:
        - messages
      summary: Получение списка сообщений чата
      description: Получение списка сообщений чата
    post:
      requestBody:
        description: Данные для создания нового сообщения
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Message"
        required: true
      parameters:
      - name: chatId
        description: Идентификатор чата
        schema:
          type: integer
        in: path
        required: true
      responses:
        "201":
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Message"
          description: Сообщение успешно создано
        "400":
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
          description: Некорректные данные
        "401":
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
          description: Неверный токен доступа
        "404":
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
          description: Чат не найден
      operationId: createMessage
      tags:
        - messages
      summary: Создание нового сообщения
      description: Создание нового сообщения
  "/message/{messageId}":
    delete:
      parameters:
      - name: messageId
        description: Идентификатор сообщения
        schema:
          type: integer
        in: path
        required: true
      responses:
        "200":
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Success"
          description: Сообщение успешно удалено
        "401":
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
          description: Неверный токен доступа
        "404":
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
          description: Сообщение не найдено
      operationId: deleteMessage
      tags:
        - messages
      summary: Удаление сообщения
      description: Удаление сообщения
  "/message/{messageId}/edit":
    post:
      requestBody:
        description: Данные для редактирования сообщения
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Message"
        required: true
      parameters:
      - name: messageId
        description: Идентификатор сообщения
        schema:
          type: integer
        in: path
        required: true
      responses:
        "200":
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Message"
          description: Сообщение успешно отредактировано
        "400":
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
          description: Некорректные данные
        "401":
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
          description: Неверный токен доступа
        "404":
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
          description: Сообщение не найдено
      operationId: editMessage
      tags:
        - messages
      summary: Редактирование сообщения
      description: Редактирование сообщения
  "/message/{messageId}/pin":
    post:
      parameters:
      - name: messageId
        description: Идентификатор сообщения
        schema:
          type: integer
        in: path
        required: true
      responses:
        "200":
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Message"
          description: Сообщение успешно закреплено
        "401":
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
          description: Неверный токен доступа
        "404":
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
          description: Сообщение не найдено
      operationId: pinMessage
      tags:
        - messages
      summary: Закрепление сообщения
      description: Закрепление сообщения
    delete:
      parameters:
      - name: messageId
        description: Идентификатор сообщения
        schema:
          type: integer
        in: path
        required: true
      responses:
        "200":
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Message"
          description: Сообщение успешно откреплено
        "401":
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
          description: Неверный токен доступа
        "404":
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
          description: Сообщение не найдено
      operationId: unpinMessage
      tags:
          - messages
      summary: Открепление сообщения
      description: Открепление сообщения
  "/messages/read":
    post:
      requestBody:
        description: Данные для отметки сообщений прочитанными
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Messages"
        required: true
      responses:
        "200":
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Success"
          description: Сообщения успешно отмечены прочитанными
        "400":
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
          description: Некорректные данные
        "401":
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
          description: Неверный токен доступа
      operationId: readMessages
      tags:
        - messages
      summary: Отметка сообщений прочитанными
      description: Отметка сообщений прочитанными
  "/search":
    get:
      parameters:
        - name: query
          description: Поисковый запрос
          schema:
            type: string
          in: query
          required: true
      responses:
        "200":
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SearchResult"
          description: Результаты поиска
        "400":
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
          description: Некорректные данные
        "401":
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
          description: Неверный токен доступа
      operationId: search
      tags:
        - search
      summary: Поиск
      description: Поиск по названиям чатов и сообщениям
components:
  schemas:
    Tokens:
      type: object
      properties:
        accessToken:
          description: Токен доступа
          type: string
        refreshToken:
          description: Токен обновления
          type: string
    User:
      required:
        - username
        - password
      type: object
      properties:
        id:
          format: int64
          type: integer
        username:
          type: string
        password:
          format: password
          type: string
        company_id:
          format: string
          description: "ID компании, к которой принадлежит пользователь (шестнадцатеричный UUID)"
          type: integer
    Chat:
      description: Краткая информация о чате
      required:
        - name
      type: object
      properties:
        id:
          format: int64
          type: integer
        name:
          type: string
        company_id:
          format: string
          description: "ID компании, к которой принадлежит чат (шестнадцатеричный UUID)"
          type: integer
    Chats:
      description: Список чатов
      type: array
      items:
        $ref: "#/components/schemas/Chat"
    ChatInstance:
      description: "Полная информация о чате, включая список участников"
      required:
        - name
      type: object
      properties:
        id:
          format: int64
          type: integer
        name:
          type: string
        company_id:
          format: string
          description: "ID компании, к которой принадлежит чат (шестнадцатеричный UUID)"
          type: integer
        users:
          type: array
          items:
            $ref: "#/components/schemas/User"
    Error:
      required:
        - message
      type: object
      properties:
        message:
          description: A human readable error message
          type: string
    UserCredentials:
      description: Данные для авторизации пользователя
      required:
        - login
        - password
      type: object
      properties:
        login:
          description: Имя пользователя
          type: string
        password:
          description: Пароль пользователя
          type: string
    Message:
      description: Сообщение
      required:
        - text
        - user_id
        - chat_id
      type: object
      properties:
        id:
          format: int64
          type: integer
        parent_id:
          format: int64
          type: integer
        created_at:
          format: date-time
          type: string
        updated_at:
          format: date-time
          type: string
        text:
          type: string
        user_id:
          format: int64
          type: integer
        chat_id:
          format: int64
          type: integer
        is_pinned:
          type: boolean
        attachments:
          type: array
          items:
            $ref: "#/components/schemas/Attachment"
        event:
          $ref: "#/components/schemas/Event"
    Attachment:
      description: Вложение
      required:
        - type
        - url
      type: object
      properties:
        id:
          format: int64
          type: integer
        created_at:
          format: date-time
          type: string
        type:
          enum:
            - image
            - video
            - audio
            - file
        url:
          type: string
        thumbnail_url:
          type: string
        size:
          format: int64
          type: integer
        name:
          type: string
    Event:
      description: Событие
      required:
        - type
      type: object
      properties:
        id:
          format: int64
          type: integer
        created_at:
          format: date-time
          type: string
        type:
          enum:
            - user_joined
            - user_left
            - chat_created
            - chat_updated
            - chat_deleted
            - chat_renamed
            - chat_avatar_updated
            - chat_avatar_deleted
            - chat_description_updated
            - chat_description_deleted
            - chat_user_added
            - chat_user_removed
        message_id:
          format: int64
          type: integer
        payload:
          type: string
    Messages:
      description: Список сообщений
      type: array
      items:
        $ref: "#/components/schemas/Message"
    SearchResult:
      description: Результаты поиска
      type: object
      properties:
        chats:
          type: array
          items:
            $ref: "#/components/schemas/Chat"
        messages:
          type: array
          items:
            $ref: "#/components/schemas/Message"
    Success:
      description: Успешный ответ
      type: object
      properties:
        success:
          type: boolean
  securitySchemes:
    AccessToken:
      type: apiKey
      name: AccessToken
      in: header
security:
  - AccessToken: [ ]
